import*as JD from"./jodash.js";import*as QRS from"./qrscanner.js";import*as I18 from"./intmain_i18n.js";import"./blx.js";import"./blStore.js";import"./FileSaver.js";import*as XTR from"./xtract_edt.js";import*as BG from"./blGraphics.js";let VERSION="V0.41 / 07.04.2025",COPYRIGHT="(C)JoEmbedded.de",connectionLevel=0,lastAdvertisingName,blxDevice,uplStatus={totalsize:0,mode:"",sumsize:0,filesize:0,filename:"",fproc:0,ndata:!1},deviceListDB=[],defLang=I18.i18_availLang[0],setupOptions={dtheme:!1,font:100,lang:defLang,server:"../sync/blxremote.php",accesstoken:"123456"},isUrlGit,sidebuttonMaincontent=(document.getElementById("bd-version").textContent=VERSION+(0<window.jdDebug?` (Dbg:${window.jdDebug})`:""),document.getElementById("sidebutton-maincontent")),sidebuttonTerminal=document.getElementById("sidebutton-terminal"),sidebuttonGraphics=document.getElementById("sidebutton-graph"),sidebuttonBluetooth=document.getElementById("sidebutton-bluetooth"),sidebuttonSetup=document.getElementById("sidebutton-setup"),sidebuttonServersync=document.getElementById("sidebutton-serversync"),sidebuttonQRscan=document.getElementById("sidebutton-qrscan"),sectionMain=document.getElementById("section_main"),sectionGraphics=document.getElementById("section_graphics"),sectionTerminal=document.getElementById("section_terminal"),sectionMainEnabled,sectionGraphicsEnabled,sectionTerminalEnabled,bdOnline=(sidebuttonMaincontent.addEventListener("click",()=>sectionMain.scrollIntoView(!0)),sidebuttonGraphics.addEventListener("click",()=>sectionGraphics.scrollIntoView(!0)),sidebuttonTerminal.addEventListener("click",()=>sectionTerminal.scrollIntoView(!1)),document.getElementById("bd-online")),bdOffline=document.getElementById("bd-offline"),lastOnlineState,blxInfoLine=(sidebuttonBluetooth.addEventListener("click",blxConnect),sidebuttonSetup.addEventListener("click",doSetupDialog),sidebuttonServersync.addEventListener("click",runServerSync),sidebuttonQRscan.addEventListener("click",bdRunQRscanner),document.getElementById("blxInfoLine")),blxGraph=document.getElementById("blxGraph"),blxCmdRes=document.getElementById("blxCmdRes"),blxConnectButtonText=document.getElementById("blxConnectButtonText"),blxMemory=document.getElementById("blxMemory"),blxSync=document.getElementById("blxSync"),blxSignal=document.getElementById("blxSignal"),blxMeasureData=document.getElementById("blxMeasureData"),blxDeviceName=document.getElementById("blxDeviceName"),blxMAC=document.getElementById("blxMAC"),blxType=document.getElementById("blxType"),blxFW=document.getElementById("blxFW"),blxPIN=document.getElementById("blxPIN"),blxBadgeButton=document.getElementById("blxBadgeButton"),blxPinEnter=document.getElementById("blxPinEnter"),blxSyncButton=document.getElementById("blxSyncButton"),blxMeasureButton=document.getElementById("blxMeasureButton"),blxRawButton=document.getElementById("blxRawButton"),blxEcholotCheck=document.getElementById("blxEcholot"),blxUploadButton=document.getElementById("blxUploadButton"),blxInfoButton=document.getElementById("blxInfoButton"),blxClearButton=document.getElementById("blxClearButton"),blxParametersButton=document.getElementById("blxParametersButton"),blxSysParButton=document.getElementById("blxSysParButton"),blxSyncButtonSpan=document.getElementById("blxSyncButtonSpan"),blxUploadButtonSpan=document.getElementById("blxUploadButtonSpan"),blxInfoButtonSpan=document.getElementById("blxInfoButtonSpan"),blxClearButtonSpan=document.getElementById("blxClearButtonSpan"),blxRawSpan=document.getElementById("blxRawSpan"),blxParametersSpan=document.getElementById("blxParametersSpan"),blxSetPinButton=document.getElementById("blxSetPinButton"),blxScanPinButton=document.getElementById("blxScanPinButton"),navDevicelist=(blxBadgeButton.addEventListener("click",blxPrintBadge),blxSetPinButton.addEventListener("click",blxSetPin),blxPIN.addEventListener("keyup",blxPinKeyUpEvent),blxScanPinButton.addEventListener("click",blxScanPin),blxInfoButton.addEventListener("click",blxMemoryInfo),blxSyncButton.addEventListener("click",blxSyncTime),blxUploadButton.addEventListener("click",blxUpload),blxMeasureButton.addEventListener("click",blxMeasure),blxRawButton.addEventListener("click",blxRaw),blxEcholotCheck.addEventListener("click",blxEcholotClick),blxClearButton.addEventListener("click",blxClearDevice),blxParametersButton.addEventListener("click",blxEditIparam),blxSysParButton.addEventListener("click",blxEditSysparam),document.getElementById("nav-devicelist")),blxDashBadgeURL,blxAutoPINURL,bdurl=new URL(location),cbSpinner=(isUrlGit=bdurl.host.includes("github."),!1);function ll(e){return I18.ll(e)}async function blxConnect(){let e=!1,t=(blxCmdRes&&(blxCmdRes.textContent="-"),disabler(!0),!1);try{2<=connectionLevel?(JD.spinnerShow("Bluetooth",""+ll("Disconnect"),10,!0),await _blxCmdSend(".d")):(void 0!==lastAdvertisingName&&(t=await JD.doDialogOK(""+ll("Reconnect?"),`${ll("Reconnect to Device?")}<br><b>${ll("Name")}: '${lastAdvertisingName}'</b><br>`+ll("OK to Reconnect (or close)"))),e=!0,t?await _blxCmdSend(".r"):await _blxCmdSend(".c"),await showLoggerDetails())}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+" [BCo]")}cbSpinner=!1,JD.spinnerClose(),disabler(!1),e&&JD.sidebarMax(.3)}blx.setTerminal("blxTerminal",bleCallback),await getSetupOptions(),await updateDeviceList(),window.addEventListener("beforeunload",function(e){if(JD.spinnerGetBusy()||4==connectionLevel)return e.preventDefault(),"Reload/Leave?"}),JD.dashSetTimer1sec(blxtimer1sec);let dcnt=0;async function disabler(e){let t=blx.getPinOK(),n=(e?sidebuttonBluetooth.classList.add("jo-disabled"):sidebuttonBluetooth.classList.remove("jo-disabled"),"none");if(!0!==t&&!1===e&&3<=connectionLevel&&(n="block"),blxPinEnter&&"block"===(blxPinEnter.style.display=n)&&void 0!==blxAutoPINURL)try{var a=blxAutoPINURL+"&mac="+blxDevice.deviceMAC;console.log("PIN-Fetch: ",a);var l=await(await fetch(a,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}})).json();if(parseInt(l.status))throw l.status;blxPIN.value=l.pin,blx.chordsound(1e3),await blxSetPin(),t=blx.getPinOK()}catch(e){JD.joPingError(),JD.doDialogOK(ll("ERROR"),"AutoPIN: "+e)}let i=e,o=(void 0!==blxDevice&&void 0!==blxDevice.devicePIN||(i=!0),blxBadgeButton&&(blxBadgeButton.disabled=i),0!=connectionLevel&&!0===t||(e=!0),blxSyncButton&&(blxSyncButton.disabled=e),blxMeasureButton&&(blxMeasureButton.disabled=e),blxRawButton&&(blxRawButton.disabled=e),blxEcholotCheck&&(blxEcholotCheck.disabled=e),blxUploadButton&&(blxUploadButton.disabled=e),blxInfoButton&&(blxInfoButton.disabled=e),blxClearButton&&(blxClearButton.disabled=e),blxParametersButton&&(blxParametersButton.disabled=e),blxSysParButton&&(blxSysParButton.disabled=e),n="none"),s=n;void 0!==blxDevice&&(!0!==e&&blxHasRaw(blxDevice.deviceType)&&(o="block"),1e3<=blxDevice.deviceType&&(n="block"),900<=blxDevice.deviceType)&&(s="block"),blxSyncButtonSpan&&(blxSyncButtonSpan.style.display=s),blxUploadButtonSpan&&(blxUploadButtonSpan.style.display=n),blxInfoButtonSpan&&(blxInfoButtonSpan.style.display=n),blxClearButtonSpan&&(blxClearButtonSpan.style.display=n),blxParametersSpan&&(blxParametersSpan.style.display=n),blxRawSpan&&(blxRawSpan.style.display=o)}async function showLoggerDetails(){if(3<=connectionLevel){blxDevice=blx.getDevice(),blxMAC&&(blxMAC.textContent=blxDevice.deviceMAC),blxType&&(blxType.textContent=blxDevice.deviceType),blxFW&&(blxFW.textContent=blxDevice.firmwareVersion),4==connectionLevel&&1e3<=blxDevice.deviceType&&(await calculateMemory(!0),await showLink());var t=blxDevice.deltaToApp;let e=t+" "+ll("sec");864e5<t?e=`<span style='background-color: red'>${ll("Time lost!")}</span>`:86400<t&&(e=(t/86400).toFixed(3)+" "+ll("d")),blxSync&&(blxSync.innerHTML=e),blxInfoLine&&(blxInfoLine.textContent=ll("Connected")),blxMeasureData&&(blxMeasureData.innerHTML="-"),updateDeviceList()}}let _blxCmdResult;async function _blxCmdSend(t,e,n=!1){_blxCmdResult=0;let a;try{n&&JD.spinnerShow(ll("Command"),t,e),a=await blx.userSendCmd(t,e),console.log("CMD->",t),n&&(JD.spinnerClose(),JD.doDialogOK(ll("Command")+": OK &nbsp;&nbsp; ",`'${t}'`))}catch(e){n&&(JD.spinnerClose(),JD.doDialogOK(ll("Command")+": "+ll("ERROR"),`'${t}'<br>`+e)),console.log("ERROR:",e),_blxCmdResult=e,connectionLevel<=2&&bleCallback("CON",0)}return a}async function calculateMemory(n){let a="???";try{n&&await _blxCmdSend(".m");var l=blx.getMemory();let e,t=(e=0<l.max?(100*l.total/l.max).toFixed(2):ll("Unknown"),"???");switch(l.mode){case 2:case 0:t=ll("Rec.OFF");break;case 1:t=ll("LINEAR");break;case 3:t=ll("RING")}a="[Total: "+l.total+"("+e+"%,"+t+")",n&&(a+=" <br class='mobile-br'>New: "+l.incnew),a+="] Byte"}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+"[BcM]")}blxMemory.innerHTML=a}async function showLink(){let e=ll("(No Data)");try{await blStore.get(blxDevice.deviceMAC+"_xtract.edt");var t=blStore.result();void 0!==t&&(e="<a target='_blank' href='../gdraw/gdraw.html?st="+blxDevice.deviceMAC+"_xtract.edt&sn="+lastAdvertisingName+`'> ${ll("Show Graph")} </a><br class='mobile-br'> (`+t.v.akt_len+" Byte, "+t.v.ctime.toLocaleString()+")")}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+" [BsL]")}blxGraph.innerHTML=e}async function blxMemoryInfo(){disabler(!0),JD.spinnerShow(ll("Memory Info"),null,60,!0);try{await _blxCmdSend("v"),await calculateMemory(!0)}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+" [BMI]")}JD.spinnerClose(),disabler(!1)}async function blxClearDevice(){if(disabler(!0),await JD.doDialogOK(ll("Clear Device?"),ll("OK to clear Device Memory?"),null,!0)){JD.spinnerShow(ll("Clear Device"),null,250);try{void 0!==blxDevice.diskCheckOK&&!0===blxDevice.diskCheckOK?(blxInfoLine&&(blxInfoLine.textContent=ll("Start new Measure, Clear all Data")),await _blxCmdSend("n")):(blxInfoLine&&(blxInfoLine.textContent=ll("Start new Measure, Clear all Data (Clean FlashDisk, may need up to 240 sec)")),await _blxCmdSend("n1",24e4)),document.getElementById("blxMemory").textContent="-",await blStore.remove(blxDevice.deviceMAC+"_xtract.edt"),await showLink()}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+" [BCD]")}JD.spinnerClose()}disabler(!1)}async function blxPinKeyUpEvent(e){13!==e.keyCode&&10!==e.keycode||(e.preventDefault(),blxSetPin())}async function blxSetPin(){blxCmdRes&&(blxCmdRes.textContent="-");var e=blxPIN.value;disabler(!0),JD.spinnerShow(ll("Set PIN"),null,300);try{if(e.length<1)throw"ERROR: PIN EMPTY";await _blxCmdSend(".i "+e),blxPIN.value="",await showLoggerDetails()}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+" [BSP]")}JD.spinnerClose(),disabler(!1)}async function blxScanPin(){await bdRunQRscanner(blxDevice.deviceMAC)}async function blxSyncTime(){disabler(!0),JD.spinnerShow(ll("Sync Device Time"),null,30,!0);try{await _blxCmdSend(".t set"),blxSync.textContent=0}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+" [BST]")}JD.spinnerClose(),disabler(!1)}async function blxUpload(){disabler(!0),JD.spinnerShow(ll("Upload Data"),null,600,!1);try{await _blxCmdSend(".u"),await calculateMemory(!1),await _blxCmdSend(".x"),await showLink()}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+" [BUp]")}await updateDeviceList(),JD.spinnerClose(),disabler(!1)}async function blxEcholotClick(){await _blxCmdSend(blxEcholotCheck.checked?".a 1":".a 0")}let measureData="???";async function blxMeasure(){disabler(!0),await blxCloseRaw(),JD.spinnerShow(ll("Measure"),null,30,!0),blxMeasureData.innerHTML=ll("Wait...");try{await _blxCmdSend("e 1")}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+" [BMe]")}JD.spinnerClose(),disabler(!1)}let p100_beschr=["*@100_System","*DEVICE_TYP","*MAX_CHANNELS","*HK_FLAGS","*NewCookie [Parameter 10-digit Timestamp.32]","Device_Name[BLE:$11/total:$41]","Period_sec[10..86400]","Period_Offset_sec[0..(Period_sec-1)]","Period_Alarm_sec[0..Period_sec]","Period_Internet_sec[0..604799]","Period_Internet_Alarm_sec[0..Period_Internet_sec]","UTC_Offset_sec[-43200..43200]","Flags (B0:Rec B1:Ring) (0: RecOff) B2:Compress","HK_flags (B0:Bat B1:Temp B2.Hum B3.Perc B4.Baro)","HK_reload[0..255]","Net_Mode (0:Off 1:OnOff 2:On_5min 3:Online)","ErrorPolicy (O:None 1:RetriesForAlarms, 2:RetriesForAll)","MinTemp_oC[-40..10]","Config0_U31 (B0:OffPer.Inet:On/Off B1,2:BLE:On/Mo/Li/MoLi B3:EnDS B4:CE:Off/On B5:Live:Off/On)","Configuration_Command[$79]","Internet_Starttime[Timestamp.32]"],pkan_beschr=["*@ChanNo","Action[0..65535] (B0:Meas B1:Cache B2:Alarms)","Physkan_no[0..65535]","Kan_caps_str[$8]","Src_index[0..255]","Unit[$8]","Mem_format[0..255] (B0..3): 0-(max)Digits, B7:AllowShortFloat","DB_id[0..2e31]","Offset[float]","Factor[float]","Alarm_hi[float]","Alarm_lo[float]","Messbits[0..65535]","Xbytes[$32]"],p200_beschr=["*@200_Sys_Param","APN[$41]","Server/VPN[$41]","Script/Id[$41]","API Key[$41]","ConFlags[0..255] (B0:Verbose B1:RoamAllow B4:LOG_FILE (B5:LOG_UART) B7:Debug)","SIM Pin[0..65535] (opt)","APN User[$41]","APN Password[$41]","Max_creg[10..255]","Port[1..65535]","Server_timeout_0[1000..65535]","Server_timeout_run[1000..65535]","Modem Check Reload[60..3600]","Bat. Capacity (mAh)[0..100000]","Bat. Volts 0%[float]","Bat. Volts 100%[float]","Max Ringsize (Bytes)[1000..2e31]","mAmsec/Measure[0..1e9]","Mobile Protocol[0..255] B0:0/1:HTTP/HTTPS B1:PUSH B2,3:TCP/UDPSetup B6:LoRa"],original_par;async function editParamDialogDo(e){var t="<div id='blxParameterEdit' class='jo-dialog-big'>";let n;return e?n=JD.prepareCustomDialog(ll("Edit Parameter")+" 'sys_param'",t,ll("Send...")):(n=JD.prepareCustomDialog(ll("Edit Parameter")+" 'iparam'",t,ll("Send..."),`<button id='editBtnAddChannel'>${ll("Add Channel")}</button>`)).querySelector("#editBtnAddChannel").addEventListener("click",()=>{try{blxEditedParamGet(0),blx.IparamAddChannel(blxDevice.iparam,!0),blxParametersCopy(!1,0);var e=document.getElementById("blxParameterEdit");e.innerHTML=blxParametersGetHtml(0),e.scrollTop=e.scrollHeight,JD.joPing()}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+" [BaC]")}}),document.getElementById("blxParameterEdit").innerHTML=blxParametersGetHtml(e),await JD.doCustomDialog(0)}function blxParCancel(e){e?blxDevice.sys_param=original_par:blxDevice.iparam=original_par,blxCmdRes&&(blxCmdRes.textContent=ll("Edit Parameters cancelled"))}function blxEditedParamGet(n){var e=(n?blxDevice.sys_param:blxDevice.iparam).length;for(let t=0;t<e;t++){var a=document.getElementById("__pidx"+t);let e=a.value.toString();!1===a.disabled&&(e="@"===e.charAt(0)?"?"+e.substr(1):e).replace("#","?"),n?blxDevice.sys_param[t]=e:blxDevice.iparam[t]=e}}async function blxParSend(e){let t;if(JD.spinnerShow(ll("Send Parameters"),null,120,!0),e)try{blxEditedParamGet(1),blxParametersCopy(!1,1);var n=blx.SysParamValidate(blxDevice.sys_param);if(n)throw"ERROR: SysParam-Check(3):\n"+n;var a=(new TextEncoder).encode(blxDevice.sys_param.join("\n")+"\n"),l=blx.getCrc32(a);await blStore.get(blxDevice.deviceMAC+"_sys_param.lxp");let e=blStore.result();if(void 0!==e&&l===e.v.crc32&&a.length===e.v.akt_len&&!1===blxDevice.sys_param_dirtyflag)return blxCmdRes&&(blxCmdRes.textContent=ll("(No Changes)")),JD.spinnerClose(),t;void 0===e&&(e={v:{}}),blxDevice.sys_param_dirtyflag=!0;var i=new TextEncoder;if(e.v.bytebuf=i.encode(blxDevice.sys_param.join("\n")+"\n"),e.v.crc32=blx.getCrc32(e.v.bytebuf),e.v.total_len=e.v.bytebuf.length,e.v.akt_len=e.v.total_len,e.v.ctime=new Date(1e3*blxDevice.sys_param[4]),e.v.esync_flag=!0,e.v.tssync=void 0,await blStore.set(blxDevice.deviceMAC+"_sys_param.lxp",e.v),await _blxCmdSend(".fput "+blxDevice.deviceMAC+"_sys_param.lxp"),_blxCmdResult)throw _blxCmdResult;if(await _blxCmdSend("Y"),_blxCmdResult)throw _blxCmdResult;blxDevice.sys_param_dirtyflag=!1,await blStore.set(blxDevice.deviceMAC+"_#BAK_sys_param.lxp",e.v)}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+"[BPb]"),await JD.doDialogOK(ll("ERROR"),ll("Parameter")+` Check 'sys_param'</b><br><br><br>${e}<br>`,null),t=e}else try{blxEditedParamGet(0),blx.CompactIparam(blxDevice.iparam),blxParametersCopy(!1,0);var o=blx.IparamValidate(blxDevice.iparam);if(o)throw"ERROR: Iparam-Check(3):\n"+o;var s=(new TextEncoder).encode(blxDevice.iparam.join("\n")+"\n"),r=blx.getCrc32(s);await blStore.get(blxDevice.deviceMAC+"_iparam.lxp");let e=blStore.result();if(void 0!==e&&r===e.v.crc32&&s.length===e.v.akt_len&&!1===blxDevice.iparam_dirtyflag)return blxCmdRes&&(blxCmdRes.textContent=ll("(No Changes)")),JD.spinnerClose(),t;void 0===e&&(e={v:{}}),blxEditedParamGet(0),blxDevice.iparam[4]=(Date.now()/1e3).toFixed(0),blxDevice.iparam_dirtyflag=!0;var c=new TextEncoder;if(e.v.bytebuf=c.encode(blxDevice.iparam.join("\n")+"\n"),e.v.crc32=blx.getCrc32(e.v.bytebuf),e.v.total_len=e.v.bytebuf.length,e.v.akt_len=e.v.total_len,e.v.ctime=new Date(1e3*blxDevice.iparam[4]),e.v.esync_flag=!0,e.v.tssync=void 0,await blStore.set(blxDevice.deviceMAC+"_iparam.lxp",e.v),await _blxCmdSend(".fput "+blxDevice.deviceMAC+"_iparam.lxp"),_blxCmdResult)throw _blxCmdResult;if(await _blxCmdSend("X"),_blxCmdResult)throw _blxCmdResult;blxDevice.iparam_dirtyflag=!1,await blStore.set(blxDevice.deviceMAC+"_#BAK_iparam.lxp",e.v)}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+"[BPa]"),await JD.doDialogOK(ll("ERROR"),ll("Parameter Check")+` 'iparam'</b><br><br><br>${e}<br>`,null),t=e}return await updateDeviceList(),JD.spinnerClose(),t}function blxParametersCopy(e,t){var n=t?blxDevice.sys_param:blxDevice.iparam;if(!0===e)if(original_par=[],void 0===n)JD.doDialogOK(ll("ERROR")+": Iparam-Check(1)","No Parameters found!",null);else{for(let e=0;e<n.length;e++)original_par[e]=n[e];blx.IparamValidate(blxDevice.iparam)&&JD.doDialogOK(ll("ERROR")+": Iparam-Check(2)","cres",null)}}function blxParametersGetHtml(e){var a=e?blxDevice.sys_param:blxDevice.iparam;let l,i=0,o="";var s="???";for(let n=0;n<a.length;n++){"@"===(s=a[n]).charAt(0)?(100===(c=parseInt(s.substring(1)))?(l=p100_beschr)[0]="*=== System ===":200===c?(l=p200_beschr)[0]="*=== Sys_Param ===":(l=pkan_beschr)[0]="*=== Channel #"+c+" ===",i=0,o+="<hr>"):i++;var r,c=void 0!==l[i]?l[i]:"(unknown)";let e,t=(c.indexOf("Timestamp.32")&&1e9<parseInt(s)&&(r=new Date(1e3*s),e=r.toUTCString()),`<span class='jo-font-small'>[${n}+(+${i})]</span>
            <input type='text' id='__pidx${n}' value='${s}'`);"*"===c.charAt(0)&&(t+=" disabled"),t+=">",e&&(t+=` ${e} `),t+=` <span class='jo-font-small'>'${l[i]}'</span><br>`,o+=t}return o}async function blxEditIparam(){for(blxParametersCopy(!0,0);;){if("OK"!==await editParamDialogDo(0)){blxParCancel(0);break}if(!await blxParSend(0))break}}async function blxEditSysparam(){for(blxParametersCopy(!0,1);;){if("OK"!==await editParamDialogDo(1)){blxParCancel(1);break}if(!await blxParSend(1))break}}function bleCallback(t,n,a){switch(t){case"CON":switch(connectionLevel=n,console.log("CON-Level: "+n),n){case 0:case 1:blxConnectButtonText&&(blxConnectButtonText.textContent=ll("Connect")),blxInfoLine&&(blxInfoLine.textContent=ll("Disconnect")),blxMemory&&(blxMemory.textContent="-"),blxSync&&(blxSync.textContent="-"),blxSignal&&(blxSignal.hidden=!0),blxMeasureData&&(blxMeasureData.innerHTML="-"),sidebuttonBluetooth.querySelector("i").classList.remove("jo-icon-ani-beat"),disabler(!1);break;case 2:lastAdvertisingName=blx.getDevice().advertisingName,blxDeviceName&&(blxDeviceName.textContent=lastAdvertisingName),blxMAC&&(blxMAC.textContent="-"),blxType&&(blxType.textContent="-"),blxFW&&(blxFW.textContent="-"),sidebuttonBluetooth.querySelector("i").classList.add("jo-icon-ani-beat"),blxSignal&&(blxSignal.textContent="... dBm"),blxSignal&&(blxSignal.style.backgroundColor="gray");var e=`${ll("Connecting")} '${lastAdvertisingName}'...`;blxConnectButtonText&&(blxConnectButtonText.textContent=e),blxInfoLine&&(blxInfoLine.textContent=e),blxGraph&&(blxGraph.innerHTML=""),JD.spinnerGetBusy()||(cbSpinner=!0,JD.spinnerShow("Bluetooth",e,30,!0));break;case 3:JD.spinnerGetBusy()&&JD.spinnerSetInfo(ll("Reading IDs...")),blxInfoLine&&(blxInfoLine.textContent=ll("Reading IDs...")),blxConnectButtonText&&(blxConnectButtonText.textContent=`'${lastAdvertisingName}'`);break;case 4:blxSignal&&(blxSignal.hidden=!1),disabler(!1),cbSpinner&&(cbSpinner=!1,JD.spinnerClose())}break;case"UPLOAD":uplStatus={totalsize:n,mode:a,sumsize:0,filesize:0,filename:"",fproc:0,ndata:!0};break;case"GET":uplStatus.filesize=n,uplStatus.filename=a,uplStatus.ndata=!0,blxInfoLine&&(blxInfoLine.textContent=ll("File")+`:'${a}' ${n} Byte`);break;case"PROG":uplStatus.fproc=n,uplStatus.ndata=!0;{let e,t;t=uplStatus.totalsize?(l=uplStatus.sumsize/uplStatus.totalsize*100,x=uplStatus.filesize/uplStatus.totalsize*uplStatus.fproc,`${e=(l+x).toFixed(0)}% of ${(uplStatus.totalsize/1024).toFixed(0)} kB`):(e=n)+"%",JD.spinnerGetBusy()&&(JD.spinnerSetProgress(e),JD.spinnerSetInfo(t)),blxInfoLine&&(blxInfoLine.textContent=e+"%")}break;case"GET_OK":uplStatus.sumsize+=n,uplStatus.ndata=!0,blxInfoLine&&(blxInfoLine.textContent=`OK (${n} ${a} )`);break;case"RSSI":{var l=.273*n+28;let e="limegreen";0<=l&&(l<4?e="gray":l<8&&(e="orange")),blxSignal&&(blxSignal.textContent=n+" dBm"),blxSignal&&(blxSignal.style.backgroundColor=e),t=void 0}break;case"VSENS":if(blxInfoLine&&(blxInfoLine.textContent="VSENS "+a+": "+n),470===blxDevice.deviceType){var i=n.split(" ");if(i[0].startsWith("Det:")){var o=parseInt(i[0].substring(4)),s=[];for(let e=0;e<o;e++){var r=i[e+1].split("/");s.push({dist:parseFloat(r[0]),sig:parseFloat(r[1])})}BG.graphType<0&&BG.enableGraphics("Radar Live Data",cbDisable470),BG.drawRadarLive(s)}}t=void 0;break;case"RADARPP":if(0<=BG.graphType){var c=new DataView(n.buffer,n.byteOffset,n.byteLength),d=n.length/2,b=new Array(d);for(let e=0;e<d;e++){var u=c.getInt16(2*e,!0);b[e]=u*u/1e4}BG.drawRadarRaw(b)}t=void 0;break;case"PPMETA":console.log("PPMeta:",n);var x=n.split(" ");4<=n.length&&BG.radarMeta(parseFloat(x[2]),parseFloat(x[3])),t=void 0;break;case"INFO":blxInfoLine&&(blxInfoLine.textContent=a);break;case"MSG":blxInfoLine&&(blxInfoLine.textContent="MSG "+n+":"+a);break;case"WARN":blxCmdRes&&(blxCmdRes.textContent="WARNING "+n+":"+a);break;case"ERR":blxCmdRes&&(blxCmdRes.textContent="ERROR "+n+":"+a);break;case"BZY":var m=parseInt(a);if(blxInfoLine)switch(n){case 1:blxInfoLine.textContent=2<m?`${ll("Info")}: ${ll("Measure")} (max. ${m} ${ll("sec")})`:ll("Info")+": "+ll("Measure");break;case 9:blxInfoLine.textContent=`${ll("Info")}: ${ll("Internet in")} ${m}  `+ll("sec");break;case 10:blxInfoLine.textContent=`${ll("Info")}: ${ll("Internet Transfer")}...`;break;case 11:blxInfoLine.textContent=m?`${ll("ERROR")}: ${ll("Internet Transfer")}: `+m:`${ll("Info")}: ${ll("Internet Transfer")}: OK`}break;case"MEAS_CH":measureData=0<n?`
${ll("Channels")}: `+n:`
${ll("Measure")}...`;break;case"MEAS_T":0<n&&(l=n/1e3,x=`(${ll("Wait Max:")} ${l} ${ll("sec")})`,measureData+=" "+x,JD.spinnerGetBusy())&&(JD.spinnerSetInfo(x),JD.spinnerSetTime(1+l)),blxMeasureData&&(blxMeasureData.innerHTML=measureData+"<br>...");break;case"MEAS_V":if("*"==a[0]&&(a=`(${ll("ALARM")}) `+a.substring(1)),90==n&&void 0!==blxDevice.sys_param&&void 0!==blxDevice.sys_param[16]){x=parseFloat(blxDevice.sys_param[15]),l=parseFloat(blxDevice.sys_param[16]);if(x<l){let e=((parseFloat(a)-x)/(l-x)*100).toFixed(2);a+="("+(e=100<e?100:e)+"%)"}}else 93==n&&void 0!==blxDevice.sys_param&&void 0!==blxDevice.sys_param[14]&&(l=parseFloat(blxDevice.sys_param[14]),!isNaN(l))&&0<l&&(a+="("+(100*parseFloat(a)/l).toFixed(2)+"%)");measureData+="<br>("+n+") "+a,blxMeasureData&&(blxMeasureData.innerHTML=measureData)}void 0!==t&&console.log("BLX: ",t,n,a)}async function getSetupOptions(){await blStore.get("#blxDash_#SETUP");var e=blStore.result(),e=(void 0!==e&&((setupOptions=e.v).dtheme&&JD.dashToggleTheme(),setupOptions.font&&JD.dashSetFont(setupOptions.font/100),setupOptions.lang)&&I18.i18localize(setupOptions.lang),await blStore.get("#blxDash_#badgeURL"),blStore.result()),e=(void 0!==e&&void 0!==e.v&&(blxDashBadgeURL=e.v,document.getElementById("blxBadge").style.display="block"),await blStore.get("#blxDash_#AutoPINURL"),blStore.result());void 0!==e&&void 0!==e.v&&(blxAutoPINURL=e.v,document.getElementById("blxAutoPIN").style.display="block")}async function doSetupDialog(){var e=await blStore.quotaget(),e=`<div>
        <div>    
        <i class="bi-info-circle"></i>    
        ${ll("Contact/Info")}: <a href="https://joembedded.de">(C)JoEmbedded.de</a>
        </div>
        <br>

        ${ll("Storage: Used Memory")}: ${e.usedMB} MB (${e.usedPerc} %)<br>
        <label for="jd-lang">${ll("Language")}</label>:
        <select id="jd-lang">
            <!-- dynamically filled -->
        </select>
        <br>
        <br>
        <label for="jd-fontsize">${ll("Fontsize")}</label>:
        <select id="jd-fontsize">
            <option>50%</option>
            <option>75%</option>
            <option>100%</option>
            <option>125%</option>
            <option>133%</option>
            <option>150%</option>
            <option>175%</option>
            <option>200%</option>
        </select>
        <br>
        <br>
        <label for="jd-theme">${ll("Theme Dark/White")}:</label> <input type="checkbox" id="jd-theme">
        <br>
        <br>
        <label for="jd-server">${ll("Remote Server")}</label>:<br>
        <div style="display: flex; align-items: center; ">
            <i class="bi-globe"></i>
            <input autocapitalize='none' style="flex-grow: 1; margin: 0 5px;" type="text" id="jd-server">
            <button id="jd-servertest"><i class="bi-globe "></i> ...</button>
        </div>
        <br>
        <label  for="jd-accesstoken">${ll("Access-Token")}</label>:<br>
        <div style="display: flex; align-items: center;">
            <i class="bi-database-lock"></i>
            <input autocapitalize='none' type="text" style="margin: 0 5px;" id="jd-accesstoken" size="20">
        </div>
    </div>`;let t=JD.prepareCustomDialog("Dashboard Setup",e,null);t.querySelector("#jd-theme").checked=setupOptions.dtheme,t.querySelector("#jd-fontsize").value=setupOptions.font+"%";e=t.querySelector("#jd-lang");let n="";I18.i18_availLang.forEach(e=>{n+=`<option>${e}</option>`}),e.innerHTML=n,t.querySelector("#jd-lang").value=setupOptions.lang,t.querySelector("#jd-server").value=setupOptions.server,t.querySelector("#jd-accesstoken").value=setupOptions.accesstoken,e.addEventListener("change",()=>{var e=t.querySelector("#jd-lang").value;setupOptions.lang=e,I18.i18localize(e),JD.joSagmal(ll("Greeting"),e)}),t.querySelector("#jd-fontsize").addEventListener("change",()=>{var e=t.querySelector("#jd-fontsize").value;setupOptions.font=parseInt(e),JD.dashSetFont(setupOptions.font/100)}),t.querySelector("#jd-theme").addEventListener("click",()=>{JD.dashToggleTheme(),setupOptions.dtheme=!setupOptions.dtheme}),t.querySelector("#jd-servertest").addEventListener("click",()=>{isUrlGit?JD.doDialogOK(ll("ERROR"),`${ll("Can't Open Server on GITs")}<br>(Host: '${location.hostname}')`):window.open(t.querySelector("#jd-server").value+"?k="+t.querySelector("#jd-accesstoken").value,"_blank")}),"OK"===await JD.doCustomDialog()&&(setupOptions.server=t.querySelector("#jd-server").value,setupOptions.accesstoken=t.querySelector("#jd-accesstoken").value),await blStore.set("#blxDash_#SETUP",setupOptions)}async function runServerSync(){if(blx.terminalPrint(ll("Server-Synchronize")+"..."),isUrlGit)JD.doDialogOK(ll("ERROR"),`${ll("Can't Open Server on GITs")}<br>(Host: '${location.hostname}')`);else{disabler(!0),JD.spinnerShow(ll("Server-Synchronize"),null,300,!1);try{var n=setupOptions.server,a=setupOptions.accesstoken;for(let t=0;t<deviceListDB.length;t++){var l=deviceListDB[t],i=l.files;if(void 0!==i&&0<i.length)for(let e=0;e<i.length;e++)if(i[e].nowsyncflag){var o=`SendFile Device/MAC: '${l.advname}'/${l.mac}, File: '${i[e].fname}'`,s=(blx.terminalPrint(o),JD.spinnerSetInfo(o),JD.spinnerSetProgress(t/deviceListDB.length*100),l.mac+"_"+i[e].fname),r=(await blStore.get(s),blStore.result());if(void 0!==r){var c=r.v,d=await SendTextFile2Server(n,"upsync",a,l.mac,i[e].fname,c);if("object"!=typeof d||"OK"!=d.status){let e=d;throw e="object"==typeof d?d.status:e}c.tssync=d.tssync,await blStore.set(s,c),JD.joPing()}}}blx.terminalPrint(ll("Server-Synchronize")+": OK")}catch(e){JD.joPingError(),JD.doDialogOK(ll("ERROR"),ll("Server-Synchronize")+`: '${e}'`),blx.terminalPrint(ll("Server-Synchronize")+`: '${e}'`)}await updateDeviceList(),JD.spinnerClose(),disabler(!1)}}async function SendTextFile2Server(e,t,n,a,l,i){try{var o=new Uint8Array(i.bytebuf),s={mac:a,filename:l,data:(new TextDecoder).decode(o)},r=await fetch(e+"?k="+n+"&cmd="+t,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(200!==r.status)throw"'"+r.status+": "+r.statusText+"'";{let t;try{t=await r.json()}catch(e){t={status:`ERROR: Server replies '${e}'`}}return t.tssync=Date.now(),t}}catch(e){return console.log("ERROR:",e),"ERROR: "+e}}async function deviceDialogDo(e){let t=deviceListDB[e];e=JD.prepareCustomDialog(ll("Device Info"),"<div id='deviceDialog-content' class='jo-dialog-big'>",null,`&nbsp;&nbsp;<button id='removeDeviceBtn'><i class = 'bi-trash3'></i> ${ll("Remove")}</button>`);e.querySelector("#removeDeviceBtn").addEventListener("click",async()=>{await JD.doDialogOK(ll("Remove Device?"),`<b>${ll("Name")}: '${t.advname}'</b><br>MAC: ${t.mac}<br>`,"<i class='bi-trash3'></i> "+ll("Remove"),!0)&&(await removeDevice(t.mac),JD.closeCustomDialog("REMOVED"))});let n=`<b>${ll("Name")}: '${t.advname}'</b><br>MAC: ${t.mac}<br>`;n=n+("<br>PIN: "+(0<t.pin?t.pin:"-"))+"<br><br>";var a=t.files.length;if(a){n+=`<table style="text-align: left;"><tr><th>${ll("File")}</th><th>Byte</th><th>&orarr;</th><th>${ll("Age")}</th><th style="text-align: center;"><i class="bi bi-download"></i></th></tr>`;for(let e=0;e<a;e++){var l,i,o,s,r=t.files[e];r.nowsyncflag?n+='<tr style="background-color:chocolate;")>':n+="<tr>","xtract.edt"==r.fname?(l="<a target='_blank' href='../gdraw/gdraw.html?st="+t.mac+"_xtract.edt&sn="+t.advname+"'> Show Graph </a>",n+=`<td>${l}</td>`):n+=`<td>'${r.fname}'</td>`,n=(n+=`<td>${r.aktlen}</td>`)+`<td> ${r.syncflag?"&#10004;":"-"}</td><td>`,void 0!==r.tssync?(l=(Date.now()-r.tssync)/1e3,l=(l=(l-=86400*(i=Math.floor(l/86400)))-3600*(o=Math.floor(l/3600)))-60*(s=Math.floor(l/60)),n+=`${i}d ${o}h ${s}min ${Math.floor(l)}sec`):n+="-",n+=`</td><td><button class='buttonexportdata' data-details='${t.mac}:${r.fname}:${t.advname}'><i class="bi bi-download"></i></button></td></tr>`}n+="</table>"}else n+=ll("No Files!");e=e.querySelector("#deviceDialog-content");e.innerHTML=n,e.querySelectorAll(".buttonexportdata").forEach(e=>e.addEventListener("click",dataexport)),await JD.doCustomDialog()}async function dataexport(e){let t=e.target.getAttribute("data-details");var e=(t=t||e.target.parentNode.getAttribute("data-details")).split(":"),a=e[0],l=e[1],e=e[2],i=`${ll("Download")} ${ll("File")}?`,o='<i class="bi bi-download"></i> '+ll("Download");if("xtract.edt"===l){JD.closeCustomDialog();var s=`<br><b>${ll("Download as CSV")}:</b><br>'${a}_xtract.csv'<br><br>`+`<label><input type="checkbox" data-flag="4" class="cbcheck"> ${ll("Decimal Comma")}</label><br>`+`<label><input type="checkbox" data-flag="2" class="cbcheck"> ${ll("Compact")}</label><br>`+`<label><input type="checkbox" data-flag="1" class="cbcheck"> ${ll("Remove Alarms")}</label><br><br>`,s=JD.prepareCustomDialog(i,s,o);let n=0;function r(e){var t=e.target.getAttribute("data-flag");n&=~t,e.target.checked&&(n|=t)}s.querySelectorAll(".cbcheck").forEach(e=>e.addEventListener("click",r)),"OK"===await JD.doCustomDialog()&&(console.log("Start KOMPLEX Download:",n),s=await XTR.data2CSV(a+"_"+l,n,a,e))&&await fileExportCSV(s,a+"_xtract.csv")}else await JD.doDialogOK(i,`'${a}_${l}'`,o)&&await _blxCmdSend(`.e ${a}_`+l)}async function fileExportCSV(e,t){try{var n=new Blob([e],{type:"application/csv;charset=utf-8"});saveAs(n,t)}catch(e){await JD.doDialogOK("ERROR (Export)",e)}}async function updateDeviceList(){deviceListDB=[];let i=0,o=0,s=0,n=(navDevicelist.innerHTML="",await blStore.iterate(function(a){var t=a.k.substr(0,16);if(16===t.length&&"_"===a.k.charAt(16)){let n;for(let e=0;e<deviceListDB.length;e++)if(deviceListDB[e].mac===t){n=e;break}void 0===n&&(l="MAC:..."+t.slice(-8),n=deviceListDB.length,deviceListDB.push({mac:t,files:[],synccnt:0,advname:l,pin:0}));var l=a.k.substr(17);if(a.k===t+"_#BlxIDs")deviceListDB[n].advname=a.v.advertisingName;else if(a.k===t+"_#PIN")deviceListDB[n].pin=a.v;else if("#"!==a.k.charAt(17)){void 0!==a.v.akt_len&&(s+=a.v.akt_len);let e=!1,t=!1;switch(l){case"data.edt":case"data.edt.old":case"iparam.lxp":case"sys_param.lxp":e=!0,void 0===a.v.tssync&&(t=!0)}deviceListDB[n].files.push({fname:l,aktlen:a.v.akt_len,syncflag:e,nowsyncflag:t,tssync:a.v.tssync}),e&&i++,t&&(deviceListDB[n].synccnt++,o++)}}}),deviceListDB.sort(function(e,t){return e.advname.localeCompare(t.advname)}),"");for(let t=0;t<deviceListDB.length;t++){var a=deviceListDB[t],l=a.files;let e;l.length?(e=`<div id="butDevDetails${t}" class="jo-sibu jo-badge-smallcircle">
            <i class="bi-file-earmark-bar-graph"></i>
            <span>'${a.advname}'</span>`,a.synccnt?e+=`<span class="jo-badge-span">&utrif;${a.synccnt}/${l.length}</span></div>`:e+=`<span class="jo-badge.span jo-badge-unimportant">${l.length}</span></div>`):e=`<div id="butDevDetails${t}" class="jo-sibu">
            <i class="bi-file-earmark-text" style="color: var(--midgray50)"></i>
            <span>'${a.advname}'</span>
            </div>`,n+=e}navDevicelist.innerHTML=n;for(let e=0;e<deviceListDB.length;e++)document.getElementById("butDevDetails"+e).addEventListener("click",()=>deviceDialogDo(e));var e=sidebuttonServersync.querySelector("i").classList,t=sidebuttonServersync.querySelector(".jo-badge-span");o?(e.add("jo-icon-ani-shake"),t.classList.remove("jo-hidden"),t.innerHTML=`&utrif;${o}/`+i):(e.remove("jo-icon-ani-shake"),t.classList.add("jo-hidden"))}async function removeDevice(t){if(16!=t.length)return!1;let n=[];if(await blStore.iterate(function(e){e.k.substr(0,16)===t&&"_"===e.k.charAt(16)&&n.push(e.k)}),!n.length)return!1;for(let e=0;e<n.length;e++)await blStore.remove(n[e]);await updateDeviceList()}function ownertoken2pin(e){return parseInt(e.substring(0,8),16)%899800+100100}async function addDevice(e,t,n){if(16!=e.length)return!1;let a;if(void 0!==t&&void 0===n){if(16!=t.length)return!1;a=ownertoken2pin(t)}else{if(void 0!==t||void 0===n)return!1;if(6!=n.length)return!1;a=n}return await blStore.set(e+"_#PIN",a.toString()),await updateDeviceList(),!0}let searchmac="",scanFoundBusy=!1;async function scanFoundAddDevice(n){if(!scanFoundBusy){if(n.toLowerCase().startsWith("http"))return a=n,blx.terminalPrint(`Scanned: '${a}'`),scanFoundBusy=!0,(l=await JD.doDialogOK("Open Link?",`'${a}''`,void 0,!0,10))&&(QRS.torchOff(),window.open(a,"_blank")),scanFoundBusy=!1,l?0:2;var a=n.split(" ");if(2==a.length&&a[0].startsWith("MAC:")){let n=a[0].substring(4);if(16==n.length){var l=deviceListDB.find(e=>e.mac==n);if(void 0===l||0==l.pin){let e=!1,t;if(blx.chordsound(750,.2,.2),a[1].startsWith("OT:")?16==(l=a[1].substring(3)).length&&(t=ownertoken2pin(l),e=await addDevice(n,l,void 0)):a[1].startsWith("PIN:")&&6==(t=a[1].substring(4)).length&&(e=await addDevice(n,void 0,t)),!0===e&&n==searchmac)return blxPIN.value=t,await JD.dashSleepMs(500),blxSetPin(),0}else blx.frq_ping(750,.1,.3);return 1}}if(n.startsWith("TXT-")&&":"==n[6]){let e=n.substring(4,6),t=n.substring(7);return blx.terminalPrint(`Text(${e}): '${t}'`),blx.frq_ping(1500,.1,.3),setTimeout(()=>JD.joSagmal(t,e.toLowerCase()),300),2}return n.startsWith("CMD")&&":"==n[3]?(l=n.substring(4),scanFoundBusy=!0,(a=await JD.doDialogOK("Run Command? &nbsp &nbsp",`'${l}'?`))&&_blxCmdSend(l,void 0,!0),scanFoundBusy=!1,a?0:2):(blx.frq_ping(30,.1,.3),-1)}}async function bdRunQRscanner(e=""){searchmac=e,QRS.setQrLogPrint(blx.terminalPrint),QRS.setScanCallback(scanFoundAddDevice),QRS.clearScannedResults();e=await QRS.openSelectedCamera();"string"==typeof e?JD.doDialogOK(ll("ERROR"),ll("Reason")+`: '${e}'`,null):await QRS.scannerBusy()}function checkViewportEnablers(){JD.isFullInViewportHeight(sectionMain)?!1!==sectionMainEnabled&&(sectionMainEnabled=!1,sidebuttonMaincontent.classList.add("jo-disabled")):!0!==sectionMainEnabled&&(sectionMainEnabled=!0,sidebuttonMaincontent.classList.remove("jo-disabled")),JD.isFullInViewportHeight(sectionGraphics)?!1!==sectionGraphicsEnabled&&(sectionGraphicsEnabled=!1,sidebuttonGraphics.classList.add("jo-disabled")):!0!==sectionGraphicsEnabled&&(sectionGraphicsEnabled=!0,sidebuttonGraphics.classList.remove("jo-disabled")),JD.isFullInViewportHeight(sectionTerminal)?!1!==sectionTerminalEnabled&&(sectionTerminalEnabled=!1,sidebuttonTerminal.classList.add("jo-disabled")):!0!==sectionTerminalEnabled&&(sectionTerminalEnabled=!0,sidebuttonTerminal.classList.remove("jo-disabled"));var e=navigator.onLine;lastOnlineState!==e&&(bdOnline.hidden=!e,bdOffline.hidden=e,(lastOnlineState=e)?sidebuttonServersync.classList.remove("jo-disabled"):sidebuttonServersync.classList.add("jo-disabled"))}function blxtimer1sec(){checkViewportEnablers()}function blxPrintBadge(){let e=blxDevice;var t;void 0!==(e=void 0===e?blx.getDevice():e).devicePIN?(t="mac="+e.deviceMAC+"&type="+e.deviceType+"&fw="+e.firmwareVersion+"&advname="+e.advertisingName+"&pin="+e.devicePIN,console.log(t),window.open(blxDashBadgeURL+"?"+encodeURI(t),"_blank")):(JD.joPingError(),JD.doDialogOK(ll("ERROR"),"No PIN"))}function blxHasRaw(e){return 470===e}async function cbDisable470(){4==connectionLevel&&470==blxDevice.deviceType&&await _blxCmdSend("p")}async function blxCloseRaw(){void 0!==blxDevice&&await BG.disableGraphics()}async function blxRaw(){if(void 0!==blxDevice)try{470===blxDevice.deviceType&&(4700!==BG.graphType?(await _blxCmdSend("pp"),BG.enableGraphics("Raw Radar Scan",cbDisable470)):BG.disableGraphics())}catch(e){JD.joPingError(),blxCmdRes&&(blxCmdRes.textContent=e+" [BRw]")}}if(window.jdDebug){document.addEventListener("wheel",e=>{var t=getComputedStyle(document.documentElement).getPropertyValue("--fontrel"),e=0<e.deltaY?.8:1.2,t=parseFloat(t)*e;JD.dashSetFont(t)});let e=document.getElementById("button-debug");e.hidden=!1,e.addEventListener("click",async()=>{BG.graphType<0?BG.enableGraphics("Raw Radar Scan"):BG.disableGraphics(),BG.testDrawRadarLive()})}console.log("blxdash.js init, Version:",VERSION);export{VERSION,COPYRIGHT};